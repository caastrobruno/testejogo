<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Super Pedido üíç</title>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#000;
  touch-action:none;
  font-family:monospace;
}
canvas{
  display:block;
  background:#5c94fc;
}
#hud{
  position:fixed;
  top:10px;
  left:10px;
  color:white;
  font-size:18px;
  z-index:5;
}
#proposal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  color:white;
  text-align:center;
  z-index:10;
}
#proposal button{
  font-size:24px;
  padding:12px 40px;
  margin:10px;
}
</style>
</head>

<body>

<div id="hud">‚ù§Ô∏è <span id="score">0</span></div>
<canvas id="game"></canvas>

<div id="proposal">
  <h1>üíñ Quer casar comigo? üíñ</h1>
  <button onclick="yes()">SIM üíç</button>
  <button onclick="no()">N√ÉO</button>
  <h2 id="final"></h2>
</div>

<script>
/* CANVAS */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const proposal = document.getElementById("proposal");
const final = document.getElementById("final");

let groundY = 0;

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
  groundY = canvas.height - 90;
}
resize();
addEventListener("resize", resize);

/* CONSTANTS */
const GRAVITY = 0.8;
const SPEED = 5;
const JUMP = -16;

/* PLAYER */
const player = {
  x: 100,
  y: 0,
  w: 32,
  h: 48,
  vx: 0,
  vy: 0,
  onGround: false,
  step: 0
};

/* CAMERA */
let camX = 0;

/* TOUCH CONTROLS (MULTITOUCH) */
let moveLeft = false;
let moveRight = false;
let wantJump = false;

canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  moveLeft = moveRight = wantJump = false;

  const third = innerWidth / 3;

  for (const t of e.touches) {
    if (t.clientX < third) moveLeft = true;
    else if (t.clientX < third * 2) wantJump = true;
    else moveRight = true;
  }

  if (wantJump && player.onGround) {
    player.vy = JUMP;
    player.onGround = false;
  }
});

canvas.addEventListener("touchend", e => {
  moveLeft = moveRight = false;
  const third = innerWidth / 3;

  for (const t of e.touches) {
    if (t.clientX < third) moveLeft = true;
    else if (t.clientX > third * 2) moveRight = true;
  }
});

/* WORLD */
const pipes = [
  {x: 500, w: 60, h: 100},
  {x: 900, w: 60, h: 140}
];

const castle = { x: 1300, w: 160, h: 180 };

/* UPDATE */
function update(){
  player.vx = moveLeft ? -SPEED : moveRight ? SPEED : 0;

  player.vy += GRAVITY;
  player.x += player.vx;
  player.y += player.vy;

  // ch√£o
  if (player.y + player.h >= groundY) {
    player.y = groundY - player.h;
    player.vy = 0;
    player.onGround = true;
  }

  // colis√£o com canos
  pipes.forEach(p => {
    if (
      player.x < p.x + p.w &&
      player.x + player.w > p.x &&
      player.y + player.h > groundY - p.h
    ) {
      if (player.vx > 0) player.x = p.x - player.w;
      if (player.vx < 0) player.x = p.x + p.w;
    }
  });

  // castelo
  if (player.x + player.w > castle.x) {
    proposal.style.display = "flex";
  }

  if (player.vx !== 0) player.step = (player.step + 1) % 20;

  camX = player.x - 150;
}

/* DRAW */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ch√£o
  ctx.fillStyle = "#7c4a16";
  ctx.fillRect(-camX, groundY, 3000, 90);

  // canos
  pipes.forEach(p => {
    ctx.fillStyle = "#2ecc71";
    ctx.fillRect(p.x - camX, groundY - p.h, p.w, p.h);
  });

  // castelo
  ctx.fillStyle = "#999";
  ctx.fillRect(castle.x - camX, groundY - castle.h, castle.w, castle.h);

  // MARIO (pixel)
  const x = player.x - camX;
  const y = player.y;

  ctx.fillStyle = "#ff0000"; // chap√©u
  ctx.fillRect(x+6, y, 20, 8);

  ctx.fillStyle = "#f1c27d"; // rosto
  ctx.fillRect(x+8, y+8, 16, 12);

  ctx.fillStyle = "#ff0000"; // camisa
  ctx.fillRect(x+4, y+20, 24, 12);

  ctx.fillStyle = "#0066ff"; // macac√£o
  ctx.fillRect(x+4, y+32, 24, 12);

  ctx.fillStyle = "#000"; // p√©s
  ctx.fillRect(x+6+(player.step<10?0:8), y+44, 6, 4);
  ctx.fillRect(x+20-(player.step<10?0:8), y+44, 6, 4);
}

/* LOOP */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

/* PROPOSAL */
function yes(){
  final.innerText = "üéâ Player 2 desbloqueado para a vida toda üéâ";
}
function no(){
  final.innerText = "‚ùå Essa fase n√£o aceita essa escolha üòè";
}
</script>

</body>
</html>
