<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mini Mario Touch</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #5c94fc;
  touch-action: none;
}
canvas {
  display: block;
}
#proposal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.8);
  color: white;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 32px;
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="proposal">ðŸŽ‰ FIM DO JOGO ðŸŽ‰</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let groundY = 0;
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
  groundY = canvas.height - 90;
}
resize();
addEventListener("resize", resize);

/* CONSTANTES */
const GRAVITY = 0.9;
const SPEED = 5;
const JUMP = -18;
const LONG_JUMP = -26;
const LONG_JUMP_PUSH = 6;
const DOUBLE_TAP_TIME = 250;

/* PLAYER */
const player = {
  x: 100,
  y: 0,
  w: 32,
  h: 48,
  vx: 0,
  vy: 0,
  onGround: false,
  dir: 1
};

/* CONTROLES */
let left = false;
let right = false;

/* CONTROLE DE PULO */
let jumpPending = false;
let jumpTapTime = 0;

/* MOVIMENTO */
function readTouches(touches){
  left = right = false;
  const third = innerWidth / 3;

  for(const t of touches){
    if(t.clientX < third) left = true;
    else if(t.clientX > third * 2) right = true;
  }
}

/* TOUCH START */
canvas.addEventListener("touchstart", e=>{
  e.preventDefault();
  const t = e.changedTouches[0];
  const third = innerWidth / 3;
  const now = performance.now();

  // ÃREA DO PULO
  if(t.clientX >= third && t.clientX <= third * 2 && player.onGround){

    // SEGUNDO TOQUE â†’ SALTO LONGO
    if(jumpPending && now - jumpTapTime < DOUBLE_TAP_TIME){
      player.vy = LONG_JUMP;
      player.vx += player.dir * LONG_JUMP_PUSH;
      player.onGround = false;
      jumpPending = false;
      return;
    }

    // PRIMEIRO TOQUE (ARMA O PULO)
    jumpPending = true;
    jumpTapTime = now;
  }

  readTouches(e.touches);
});

canvas.addEventListener("touchmove", e=>{
  e.preventDefault();
  readTouches(e.touches);
});

canvas.addEventListener("touchend", e=>{
  e.preventDefault();
  readTouches(e.touches);
});

/* MUNDO */
const pipes = [
  {x: 500, w: 44, h: 110},
  {x: 900, w: 44, h: 160}
];

const castle = { x: 1300, w: 220, h: 200 };
let camX = 0;

/* UPDATE */
function update(){

  // EXECUTA PULO NORMAL SE NÃƒO HOUVE SEGUNDO TOQUE
  if(jumpPending && performance.now() - jumpTapTime > DOUBLE_TAP_TIME){
    player.vy = JUMP;
    player.onGround = false;
    jumpPending = false;
  }

  if(left){
    player.vx = -SPEED;
    player.dir = -1;
  } else if(right){
    player.vx = SPEED;
    player.dir = 1;
  } else {
    player.vx = 0;
  }
