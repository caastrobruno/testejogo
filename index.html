<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#5c94fc;
}
canvas{display:block;}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* RESIZE */
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

/* CONSTANTES */
const GRAVITY = 0.8;
const SPEED = 5;
const JUMP = -16;
const LONG_JUMP = -20;
const DOUBLE_TAP_TIME = 250;

/* PLAYER */
const player = {
  x:100,
  y:0,
  w:30,
  h:45,
  vx:0,
  vy:0,
  onGround:false,
  lastJumpTime:0,
  longUsed:false,
  dir:1
};

const groundY = () => canvas.height - 80;

/* ================= CONTROLES (NÃƒO MEXIDOS) ================= */
let leftFinger = null;
let rightFinger = null;
let jumpFinger = null;

canvas.addEventListener("touchstart", e=>{
  e.preventDefault();

  for(const t of e.changedTouches){
    const third = canvas.width / 3;
    const now = Date.now();

    if(t.clientX < third && leftFinger === null){
      leftFinger = t.identifier;
      player.dir = -1;
    }
    else if(t.clientX > third*2 && rightFinger === null){
      rightFinger = t.identifier;
      player.dir = 1;
    }
    else if(
      t.clientX >= third &&
      t.clientX <= third*2 &&
      jumpFinger === null
    ){
      jumpFinger = t.identifier;

      if(player.onGround){
        player.vy = JUMP;
        player.onGround = false;
        player.lastJumpTime = now;
        player.longUsed = false;
      }
      else if(
        !player.longUsed &&
        now - player.lastJumpTime < DOUBLE_TAP_TIME
      ){
        player.vy = LONG_JUMP;
        player.longUsed = true;
      }
    }
